<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8">
<title>STN25XR | Öxnehaga | Huskvarna</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- ArcGIS -->
<link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.30/"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, Helvetica, sans-serif;
}

/* ===== HEADER ===== */
#header {
  height: 70px;
  background: #f4f4f4;
  border-bottom: 2px solid #ccc;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  box-sizing: border-box;
}

/* ===== LEFT MENU ===== */
#left {
  position: absolute;
  top: 70px;
  left: 0;
  width: 240px;
  bottom: 0;
  background: #222;
  color: #fff;
  padding: 16px;
  box-sizing: border-box;
}

/* ===== RIGHT PANEL ===== */
#right {
  position: absolute;
  top: 70px;
  right: 0;
  width: 320px;
  bottom: 0;
  background: #f7f7f7;
  border-left: 2px solid #ccc;
  padding: 12px;
  box-sizing: border-box;
  overflow: auto;
}

/* ===== MAP ===== */
#sceneView {
  position: absolute;
  top: 70px;
  left: 240px;
  right: 320px;
  bottom: 0;
}

label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

td {
  padding: 4px;
  border-bottom: 1px solid #ddd;
}

td:first-child {
  font-weight: bold;
  width: 45%;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div id="header">
  <div><b>STN25XR | Öxnehaga | Huskvarna</b></div>
  <div>
    <span id="temp">Temp: …</span> |
    <span id="clock">00:00:00</span>
  </div>
</div>

<!-- ===== LEFT MENU ===== -->
<div id="left">
  <label>Byggnader <input type="checkbox" id="swBuildings" checked></label>
  <label>Oxnehaga area <input type="checkbox" id="swOx" checked></label>
  <label>Busshållplatser <input type="checkbox" id="swBus" checked></label>
  <label>Kommunal skolmark <input type="checkbox" id="swMark" checked></label>
  <label>Vatten område <input type="checkbox" id="swWater" checked></label>
</div>

<!-- ===== RIGHT PANEL ===== -->
<div id="right">
  <h3>Attribut</h3>
  <div id="attrHint">Klicka på ett objekt i kartan</div>
  <table id="attrTable"></table>
</div>

<!-- ===== MAP ===== -->
<div id="sceneView"></div>

<!-- ===== CLOCK & WEATHER ===== -->
<script>
setInterval(function () {
  document.getElementById("clock").textContent =
    new Date().toLocaleTimeString("sv-SE");
}, 1000);

fetch("https://api.open-meteo.com/v1/forecast?latitude=57.796&longitude=14.200&current=temperature_2m")
  .then(function (r) { return r.json(); })
  .then(function (d) {
    document.getElementById("temp").textContent =
      "Temp: " + d.current.temperature_2m + " °C";
  });
</script>

<!-- ===== ARCGIS ===== -->
<script>
require([
  "esri/Map",
  "esri/views/SceneView",
  "esri/layers/GeoJSONLayer"
], function (Map, SceneView, GeoJSONLayer) {

  /* ===== MAP & VIEW ===== */
  const map = new Map({
    basemap: "satellite",
    ground: "world-elevation"
  });

  const view = new SceneView({
    container: "sceneView",
    map: map,
    camera: {
      position: { latitude: 57.796, longitude: 14.200, z: 1500 },
      tilt: 45
    }
  });

  /* ===== LAYERS ===== */

  const buildings = new GeoJSONLayer({
    url: "./data/Main_byggnad.geojson.json",
    elevationInfo: { mode: "relative-to-ground" },
    renderer: {
      type: "simple",
      symbol: {
        type: "polygon-3d",
        symbolLayers: [{
          type: "extrude",
          size: 10,
          material: { color: "#9e9e9e" }
        }]
      }
    }
  });

  const ox = new GeoJSONLayer({
    url: "./data/Oxnehaga-Area.geojson",
    elevationInfo: { mode: "on-the-ground" },
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-fill",
        color: [0, 120, 255, 0.25],
        outline: { color: [0, 120, 255], width: 2 }
      }
    }
  });

  const bus = new GeoJSONLayer({
    url: "./data/Busshallplaster_oxnehaga.geojson",
    elevationInfo: { mode: "relative-to-ground", offset: 1 },
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-marker",
        color: [255, 140, 0],
        size: 8,
        outline: { color: "white", width: 1 }
      }
    }
  });

  const mark = new GeoJSONLayer({
    url: "./data/Komunal_mark.geojson",
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-fill",
        color: [0, 160, 80, 0.35],
        outline: { color: [0, 120, 60], width: 1 }
      }
    }
  });

  const water = new GeoJSONLayer({
    url: "./data/Vatten_jonkoping_01.geojson",
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-fill",
        color: [0, 150, 200, 0.4],
        outline: { color: [0, 120, 180], width: 1 }
      }
    }
  });

  map.addMany([ox, mark, water, buildings, bus]);

  /* ===== AUTO ZOOM TO ÖXNEHAGA ===== */
  view.whenLayerView(ox).then(function () {
    ox.queryExtent().then(function (result) {
      view.goTo(
        { target: result.extent.expand(1.4), tilt: 40 },
        { duration: 1200 }
      );
    });
  });

  /* ===== SWITCHES ===== */
  document.getElementById("swBuildings").onchange = function (e) {
    buildings.visible = e.target.checked;
  };
  document.getElementById("swOx").onchange = function (e) {
    ox.visible = e.target.checked;
  };
  document.getElementById("swBus").onchange = function (e) {
    bus.visible = e.target.checked;
  };
  document.getElementById("swMark").onchange = function (e) {
    mark.visible = e.target.checked;
  };
  document.getElementById("swWater").onchange = function (e) {
    water.visible = e.target.checked;
  };

  /* ===== CLICK → RIGHT PANEL ===== */
  view.on("click", function (event) {
    view.hitTest(event).then(function (hit) {
      const found = hit.results.find(function (r) {
        return r.graphic;
      });
      if (!found) return;

      document.getElementById("attrHint").style.display = "none";
      const table = document.getElementById("attrTable");
      table.innerHTML = "";

      const attrs = found.graphic.attributes;
      for (const key in attrs) {
        const row = "<tr><td>" + key + "</td><td>" + attrs[key] + "</td></tr>";
        table.innerHTML += row;
      }
    });
  });

});
</script>

</body>
</html>


