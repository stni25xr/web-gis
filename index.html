
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8" />
    <title>3D Map – Jönköping</title>

    <!-- ArcGIS JavaScript API (KORREKT IMPORT) -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.30/"></script>

    <style>
        html, body {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* HEADER */
        #header {
            height: 70px;
            background: #f5f5f5;
            padding: 0 20px;
            border-bottom: 2px solid #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #header-title { font-size: 22px; font-weight: bold; }
        #header-info { text-align: right; font-size: 14px; }

        /* SIDEBAR */
        #sidebar {
            position: fixed;
            top: 70px;
            left: 0;
            width: 220px;
            height: calc(100% - 70px);
            background: #222;
            color: #fff;
            padding: 20px;
        }
        .menu-button {
            width: 100%;
            background: #444;
            border: none;
            padding: 10px;
            margin: 8px 0;
            color: #fff;
            cursor: pointer;
            border-radius: 4px;
        }

        /* MAP */
        #mapView {
            position: absolute;
            top: 70px; left: 220px;
            width: calc(100% - 220px);
            height: calc(100% - 70px);
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <div id="header">
        <div id="header-title">STNI25XR – Jönköping</div>
        <div id="header-info">
            <div>Jönköping – ca 145 000 invånare</div>
            <div id="temp">Temperatur: ...</div>
            <div id="clock">00:00:00</div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar">
        <button class="menu-button" id="btnBuildings">Visa byggnader</button>
        <button class="menu-button" id="btnLayers">Visa Oxnehaga</button>
    </div>

    <!-- MAP -->
    <div id="mapView"></div>

    <script>
        /* ================= CLOCK ================= */
        function updateClock() {
            document.getElementById("clock").textContent =
                new Date().toLocaleTimeString("sv-SE");
        }
        setInterval(updateClock, 1000);
        updateClock();

        /* ================= WEATHER ================= */
        async function updateTemperature() {
            try {
                const res = await fetch(
                    "https://api.open-meteo.com/v1/forecast?latitude=57.78&longitude=14.16&current_weather=true"
                );
                const data = await res.json();
                document.getElementById("temp").textContent =
                    "Temperatur: " + data.current_weather.temperature + "°C";
            } catch {
                document.getElementById("temp").textContent = "Temperatur: N/A";
            }
        }
        updateTemperature();
        setInterval(updateTemperature, 300000);

        /* ================= ARCGIS ================= */
        require([
            "esri/Map",
            "esri/views/SceneView",
            "esri/layers/SceneLayer",
            "esri/layers/GeoJSONLayer"
        ], function(Map, SceneView, SceneLayer, GeoJSONLayer) {

            /* ===== MAP ===== */
            const map = new Map({
                basemap: "satellite",
                ground: "world-elevation"
            });

            /* ===== VIEW ===== */
            const view = new SceneView({
                container: "mapView",
                map: map,
                viewingMode: "global",
                camera: {
                    position: {
                        latitude: 57.796,
                        longitude: 14.200,
                        z: 2500   // tillräckligt högt för att se hela GeoJSON-området
                    },
                    tilt: 45
                }
            });

            /* ===== 3D-BUILDINGS ===== */
            const buildingsLayer = new SceneLayer({
                portalItem: {
                    id: "c444b24b184c4523a5dc96248bfea4e1"
                    // Open 3D Buildings (global)
                }
            });
            map.add(buildingsLayer);

            /* ===== OXNEHAGA GEOJSON (DIN FIL) ===== */
            const oxLayer = new GeoJSONLayer({
                url: "./data/Oxnehaga-Area.geojson",
                title: "Oxnehaga Area",
                renderer: {
                    type: "simple",
                    symbol: {
                        type: "simple-fill",
                        color: [0, 100, 255, 0.15],
                        outline: { color: [0, 100, 255], width: 2 }
                    }
                },
                elevationInfo: { mode: "on-the-ground" }
            });
            map.add(oxLayer);

            /* ================= AUTO-ZOOM ================= */
            oxLayer.when(() => {
                view.goTo(oxLayer.fullExtent, { duration: 2000 });
            });

            /* ================= BUTTONS ================= */
            document.getElementById("btnBuildings").onclick = () => {
                buildingsLayer.visible = !buildingsLayer.visible;
            };
            document.getElementById("btnLayers").onclick = () => {
                oxLayer.visible = !oxLayer.visible;
            };

        });
    </script>

</body>
</html>