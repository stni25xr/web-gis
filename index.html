<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<title>STN25XR | Öxnehaga 3D</title>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- ArcGIS -->
<link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.30/"></script>

<style>
html, body, #sceneView {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
}

#sidebar {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 99;
  background: #222;
  color: white;
  padding: 12px;
  border-radius: 6px;
  font-family: Arial;
}

label { display:block; margin-bottom:8px; }
</style>
</head>

<body>

<div id="sidebar">
  <label><input type="checkbox" id="swBuildings" checked> Byggnader</label>
  <label><input type="checkbox" id="swOx" checked> Oxnehaga</label>
  <label><input type="checkbox" id="swBus" checked> Busshållplatser</label>
</div>

<div id="sceneView"></div>

<script>
require([
  "esri/Map",
  "esri/views/SceneView",
  "esri/layers/SceneLayer",
  "esri/layers/GeoJSONLayer"
], function (Map, SceneView, SceneLayer, GeoJSONLayer) {

  const map = new Map({
    basemap: "satellite",
    ground: "world-elevation"
  });

  const view = new SceneView({
    container: "sceneView",
    map: map,
    camera: {
      position: { latitude: 57.796, longitude: 14.200, z: 1500 },
      tilt: 45
    }
  });

  /* === 3D Buildings === */
  const buildings = new SceneLayer({
    portalItem: {
      id: "c444b24b184c4523a5dc96248bfea4e1"
    }
  });
  map.add(buildings);

  /* === Oxnehaga area === */
  const ox = new GeoJSONLayer({
    url: "./data/Oxnehaga-Area.geojson",
    elevationInfo: { mode: "on-the-ground" },
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-fill",
        color: [0, 120, 255, 0.3],
        outline: { color: "cyan", width: 2 }
      }
    },
    popupTemplate: {
      title: "Oxnehaga",
      content: "Område"
    }
  });
  map.add(ox);

  /* === Bus stops === */
  const bus = new GeoJSONLayer({
    url: "./data/Busshallplaster_oxnehaga.geojson",
    elevationInfo: { mode: "relative-to-ground", offset: 1 },
    renderer: {
      type: "simple",
      symbol: {
        type: "simple-marker",
        color: "dodgerblue",
        size: 8,
        outline: { color: "white", width: 1 }
      }
    },
    popupTemplate: {
      title: "Busshållplats",
      content: `
        <ul>
          <li><b>Namn:</b> {name}</li>
          <li><b>ID:</b> {id}</li>
        </ul>
      `
    }
  });
  map.add(bus);

  /* === Zoom === */
  view.whenLayerView(ox).then(() => {
    ox.queryExtent().then(r => view.goTo(r.extent.expand(1.5)));
  });

  /* === UI === */
  document.getElementById("swBuildings").onchange = e => buildings.visible = e.target.checked;
  document.getElementById("swOx").onchange = e => ox.visible = e.target.checked;
  document.getElementById("swBus").onchange = e => bus.visible = e.target.checked;

});
</script>

</body>
</html>
