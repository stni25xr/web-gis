<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STN25XR | √ñxnehaga | Huskvarna</title>

  <!-- ArcGIS JavaScript API ‚Äì RIKTIGA TAGGAR -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.30/"></script>

  <style>
    html, body { margin:0; padding:0; height:100%; width:100%; overflow:hidden; font-family:Arial, Helvetica, sans-serif; }

    /* HEADER */
    #header {
      height:70px; background:#f5f5f5; border-bottom:2px solid #ccc;
      padding:0 20px; display:flex; justify-content:space-between; align-items:center;
    }
    #header-info { text-align:right; font-size:14px; line-height:1.25; }
    #clock { color:#666; }

    /* SIDEBAR */
    #sidebar {
      position:fixed; top:70px; left:0; width:260px; height:calc(100% - 70px);
      background:#222; color:#fff; padding:20px; overflow-y:auto; z-index:10;
    }
    #sidebar h2 {
      margin:0 0 12px 0; font-size:16px; color:#ddd; border-bottom:1px solid #444; padding-bottom:8px;
    }
    .switch-row { display:flex; justify-content:space-between; align-items:center; margin:14px 0; }
    .switch-label { font-size:14px; }

    /* SWITCH */
    .switch { position:relative; width:44px; height:24px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider {
      position:absolute; inset:0; background:#555; border-radius:24px; cursor:pointer; transition:.2s;
    }
    .slider:before {
      content:""; position:absolute; left:3px; top:3px; width:18px; height:18px;
      background:white; border-radius:50%; transition:transform .2s;
    }
    input:checked + .slider { background:#2d6cdf; }
    input:checked + .slider:before { transform:translateX(20px); }

    /* MAP */
    #sceneView {
      position:absolute; top:70px; left:260px;
      width:calc(100% - 260px); height:calc(100% - 70px);
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div id="header">
    <div id="header-title">STN25XR | √ñxnehaga | Huskvarna</div>
    <div id="header-info">
      <div>√ñxnehaga i Huskvarna ‚Äì ca 3400 inv√•nare</div>
      <div id="wx-summary">V√§der: ‚Ä¶</div>
      <div id="wx-precip">Nederb√∂rd: ‚Ä¶</div>
      <div id="wx-snow">Sn√∂risk: ‚Ä¶</div>
      <div id="temp">Temperatur: ‚Ä¶</div>
      <div id="clock">00:00:00</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <h2>Meny</h2>

    <div class="switch-row">
      <span class="switch-label">Visa byggnader</span>
      <label class="switch"><input id="swBuildings" type="checkbox" checked><span class="slider"></span></label>
    </div>

    <div class="switch-row">
      <span class="switch-label">Visa Oxnehaga</span>
      <label class="switch"><input id="swOx" type="checkbox" checked><span class="slider"></span></label>
    </div>

    <div class="switch-row">
      <span class="switch-label">Visa bussh√•llplatser</span>
      <label class="switch"><input id="swBus" type="checkbox" checked><span class="slider"></span></label>
    </div>
  </aside>

  <!-- 3D MAP -->
  <div id="sceneView"></div>

  <!-- CLOCK -->
  <script>
    function updateClock() {
      document.getElementById("clock").textContent =
        new Date().toLocaleTimeString("sv-SE");
    }
    setInterval(updateClock,1000); updateClock();
  </script>

  <!-- WEATHER -->
  <script>
    function describeWeather(code) {
      const map = {
        0:"‚òÄÔ∏è Klart",1:"üå§Ô∏è Mest klart",2:"‚õÖ Molnigt",3:"‚òÅÔ∏è Mulet",
        61:"üåßÔ∏è L√§tt regn",63:"üåßÔ∏è Regn",65:"üåßÔ∏è Kraftigt regn",
        71:"‚ùÑÔ∏è Sn√∂fall",73:"‚ùÑÔ∏è Sn√∂fall",75:"‚ùÑÔ∏è Kraftigt sn√∂fall",
        85:"‚ùÑÔ∏è Sn√∂byar",95:"‚õàÔ∏è √Öska"
      };
      return map[code] || "V√§xlande";
    }

    async function updateWeather() {
      try {
        const url =
          "https://api.open-meteo.com/v1/forecast?latitude=57.796&longitude=14.200"
          + "&current=temperature_2m,weather_code"
          + "&hourly=precipitation_probability,snowfall"
          + "&timezone=auto";

        const r = await fetch(url);
        const d = await r.json();

        const temp = d.current.temperature_2m;
        const wc   = d.current.weather_code;

        const p = d.hourly.precipitation_probability;
        const s = d.hourly.snowfall;

        document.getElementById("temp").textContent = "Temperatur: " + temp + "¬∞C";
        document.getElementById("wx-summary").textContent = "V√§der: " + describeWeather(wc);
        document.getElementById("wx-precip").textContent = "Nederb√∂rd: " + p[0] + " %";
        document.getElementById("wx-snow").textContent = "Sn√∂ (2h): " + s[0] + " mm";

      } catch(e) {
        console.warn("Weather error:", e);
      }
    }
    updateWeather();
  </script>

  <!-- ARCGIS 3D MAP -->
  <script>
    require([
      "esri/Map",
      "esri/views/SceneView",
      "esri/layers/SceneLayer",
      "esri/layers/GeoJSONLayer"
    ], function(Map, SceneView, SceneLayer, GeoJSONLayer) {

      const map = new Map({
        basemap: "satellite",
        ground: "world-elevation"
      });

      const view = new SceneView({
        container: "sceneView",
        map,
        camera: { position:{ latitude:57.796, longitude:14.20, z:1800 }, tilt:45 }
      });

      /* === 3D BYGGNADER === */
      const buildings = new SceneLayer({
        portalItem:{ id:"c444b24b184c4523a5dc96248bfea4e1" },
        visible:true
      });
      map.add(buildings);

      /* === OXNEHAGA POLYGON === */
      const ox = new GeoJSONLayer({
        url:"./data/Oxnehaga-Area.geojson",
        renderer:{
          type:"simple",
          symbol:{
            type:"simple-fill",
            color:[0,100,255,0.25],
            outline:{ color:[0,100,255], width:2 }
          }
        },
        elevationInfo:{ mode:"on-the-ground" },
        visible:true
      });
      map.add(ox);

      /* === BUSSH√ÖLLPLATSER === */
      const bus = new GeoJSONLayer({
        url:"./data/Busshallplaster_oxnehaga.geojson",   <!-- ditt nya namn -->
        title:"Bussh√•llplatser",
        renderer:{
          type:"simple",
          symbol:{
            type:"simple-marker",
            color:[0,120,255,0.95],
            size:8,
            outline:{ color:"white", width:1 }
          }
        },
        popupTemplate:{
          title:"Bussh√•llplats",
          content:[
            { type:"fields", fieldInfos:[] }   // Visa ALLA attribut tills vi vet vilka du vill ha
          ]
        },
        elevationInfo:{ mode:"on-the-ground" },
        visible:true
      });
      map.add(bus);

      /* === AUTO-ZOOM === */
      view.whenLayerView(ox).then(() => {
        ox.queryExtent().then((res) => {
          view.goTo({ target: res.extent, tilt:38 }, { duration:1200 });
        });
      });

      /* === SWITCHAR === */
      swBuildings.onchange = () => buildings.visible = swBuildings.checked;
      swOx.onchange        = () => ox.visible        = swOx.checked;
      swBus.onchange       = () => bus.visible       = swBus.checked;

    });
  </script>

</body>
</html>
``
